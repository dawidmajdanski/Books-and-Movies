<!--
 - Created by Dawid MajdaÅ„ski on 31.01.2019.
 -->

<aura:component description="BM_CustomProductSearch" implements="forceCommunity:searchInterface"
                controller="BM_ProductSearchController">
    <ltng:require styles="/resource/dontDisplayLogo"/>

    <aura:attribute name="isAdvSearchDisplayed" type="Boolean" default="false"/>
    <aura:attribute name="searchText" type="String" default=""/>
    <aura:attribute name="minPrice" type="Decimal"/>
    <aura:attribute name="maxPrice" type="Decimal"/>
    <aura:attribute name="minRating" type="Integer"/>
    <aura:attribute name="specificYear" type="Integer"/>
    <aura:attribute name="minYear" type="Integer"/>
    <aura:attribute name="maxYear" type="Integer"/>
    <aura:attribute name="bookGenre" type="String"/>
    <aura:attribute name="movieGenre" type="String"/>
    <aura:attribute name="bookGenres" type="String[]"/>
    <aura:attribute name="movieGenres" type="String[]"/>
    <aura:attribute name="author" type="String"/>
    <aura:attribute name="director" type="String"/>
    <aura:attribute name="productType" type="String" default="All"/>
    <aura:attribute name="cartItemsQuantity" type="Integer" default="0"/>
    <aura:attribute name="cartProducts" type="Object[]"/>
    <aura:attribute name="totalCartPrice" type="Decimal" default="0"/>

    <aura:handler name="init" value="{!this}" action="{!c.init}"/>
    <aura:handler event="c:BM_ProductsCartQuantityEvent" action="{!c.handleUpdateCartProductsQuantity}"/>

    <div class="slds-form-element slds-lookup" data-select="single">
        <div class="slds-form-element__control">
            <div class="slds-input-has-icon slds-input-has-icon--right">
                <lightning:buttonIcon iconName="utility:search" variant="bare" onclick="{! c.handleClick }"
                                      alternativeText="Search" class="slds-input__icon"/>
                <ui:inputText value="{!v.searchText}" class="slds-lookup__search-input slds-input"
                              placeholder="{!$Label.c.Search_placeholder}"/>
            </div>
            <div id="arrowDiv" class="arrowContainer" title="{!$Label.c.Advanced_search}"
                 onclick="{!c.onAdvancedSearchModalAppearance}">
                <lightning:icon iconName="utility:chevronleft" class="iconPosition"/>
            </div>

            <div id="cart" class="cartContainer" onclick="{!c.handleCartRollDown}">
                <img class="cartIco" src="{!$Resource.CartIcon}" />
                <span class="cartItemsQuantity">{!v.cartItemsQuantity}</span>
                <span id="cartItemsTotalPrice" class="cartItemsTotalPrice">{!$Label.c.Total_price}&nbsp;{!v.totalCartPrice}$</span>
            </div>
            <div id="cartPreview" class="cartPreview">
                <aura:if isTrue="{!v.cartProducts==null || v.cartProducts.length==0}">
                    <p class="cartEmptyInfo">{!$Label.c.Empty_cart}</p>
                </aura:if>
                <table style="width:91.5%; margin-left: 0.5rem; margin-right: 0.5rem; color: white; font-family: 'Lucida Sans Unicode'; margin-top: 0.25rem;">
                    <aura:iteration items="{!v.cartProducts}" var="cartProduct" indexVar="ind">
                            <tr>
                                <td style="padding-top: 0.25rem">
                                    {!cartProduct.productName}&nbsp;
                                </td>
                                <td style="text-align: right; padding-top: 0.25rem; padding-left: 2px;">
                                    <aura:if isTrue="{!cartProduct.discountPrice!=null}">{!cartProduct.quantity}x&nbsp;{!cartProduct.discountPrice}$<br/></aura:if>
                                    <aura:if isTrue="{!cartProduct.discountPrice==null}">{!cartProduct.quantity}x&nbsp;{!cartProduct.productPrice}$<br/></aura:if>
                                </td>
                                <td style="text-align: right; padding-top: 0.25rem; padding-left: 7px; cursor: pointer" onclick="{!c.handleRemoveProductFromCart}" data-index="{!ind}">
                                    <lightning:icon iconName="utility:clear" size="xx-small" variant="inverse"/>
                                </td>
                            </tr>
                    </aura:iteration>
                </table>
                <button onclick="{!c.handleProductsInCart}"
                        class="slds-button slds-button_success productsInCartBtn">
                        {!$Label.c.Show_cart}
                </button>
                <div onclick="{!c.handleCartRollUp}">
                    <lightning:icon iconName="utility:chevronup" class="iconScrollUp" variant="bare" size="small"/>
                </div>
            </div>

            <div class="myOrdersContainer" onclick="{!c.handleMyOrders}">
                <span>{!$Label.c.My_orders}</span>
            </div>

            <div id="advSearchModal" class="advancedSearchDiv hideModal">
                <lightning:tabset class="advSearchModalTabset" selectedTabId="{!v.productType}" onselect="{!c.handleChangeTabset}">
                    <lightning:tab label="{!$Label.c.All_tab}" id="All">
                        <div class="slds-form-element tabsetPadding">
                            <c:BM_ProductSearchSharedParams aura:id="clearAvailableYears" specificYear="{!v.specificYear}" minYear="{!v.minYear}"
                                                            maxYear="{!v.maxYear}" minPrice="{!v.minPrice}"
                                                            maxPrice="{!v.maxPrice}"/>
                        </div>
                    </lightning:tab>
                    <lightning:tab label="{!$Label.c.Books_tab}" id="Books">
                        <div class="slds-form-element tabsetPadding">
                            <c:BM_ProductSearchSharedParams aura:id="clearAvailableYears1" specificYear="{!v.specificYear}" minYear="{!v.minYear}"
                                                            maxYear="{!v.maxYear}" minPrice="{!v.minPrice}"
                                                            maxPrice="{!v.maxPrice}"/>
                            <div id="book_genre_param" class="searchParamsGridStyle">
                                <lightning:select aura:id="selectBookGenre" name="selectBookGenre" label="{!$Label.c.Genre}" onchange="{!c.handleBookGenreChange}">
                                    <option value="">{!$Label.c.All_genres}</option>
                                    <aura:iteration items="{!v.bookGenres}" var="genre" >
                                        <option>{!genre}</option>
                                    </aura:iteration>
                                </lightning:select>
                            </div>
                            <div id="book_author_param" class="searchParamsGridStyle">
                                <lightning:input label="{!$Label.c.Author}" class="input_Param" type="text" value="{!v.author}" />
                            </div>
                        </div>
                    </lightning:tab>
                    <lightning:tab label="{!$Label.c.Movies_tab}" id="Movies">
                        <div class="slds-form-element tabsetPadding">
                            <c:BM_ProductSearchSharedParams aura:id="clearAvailableYears2" specificYear="{!v.specificYear}" minYear="{!v.minYear}"
                                                            maxYear="{!v.maxYear}" minPrice="{!v.minPrice}"
                                                            maxPrice="{!v.maxPrice}"/>
                            <div id="movie_genre_param" class="searchParamsGridStyle">
                                <lightning:select aura:id="selectMovieGenre" name="selectMovieGenre" label="{!$Label.c.Genre}" onchange="{!c.handleMovieGenreChange}">
                                    <option value="">{!$Label.c.All_genres}</option>
                                    <aura:iteration items="{!v.movieGenres}" var="genre" >
                                        <option>{!genre}</option>
                                    </aura:iteration>>
                                </lightning:select>
                            </div>
                            <div id="director_param" class="searchParamsGridStyle">
                                <lightning:input label="{!$Label.c.Director}" class="input_Param" type="text" value="{!v.director}" />
                            </div>
                        </div>
                    </lightning:tab>
                </lightning:tabset>

                <div onclick="{! c.handleClearParams}">
                    <lightning:icon iconName="utility:clear" title="{!$Label.c.Clear_search}" class="custom-slds-icon-clear"
                                    size="x-small"/>
                </div>
                <div onclick="{! c.handleClick }">
                    <lightning:icon iconName="utility:search" title="{!$Label.c.Search}" class="custom-slds-icon-search"
                                    size="x-small"/>
                </div>

            </div>
        </div>
    </div>
</aura:component>